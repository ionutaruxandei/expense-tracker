<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    <div ng-app="asd">
        <form id='register' action='/register' method='post'>
            <label for='email' >Email Address*:</label>
            <input type='text' name='email' id='email' maxlength="50" />
            <label for='userName' >UserName*:</label>
            <input type='text' name='userName' id='userName' maxlength="50" />
            <label for='password' >Password*:</label>
            <input type='password' name='password' id='password' maxlength="50" />
            <input type='submit' name='Submit' value='Submit' />
        </form>


        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.9/angular.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
        <script>
            var app = angular.module('asd', []);
            app.controller("register", ['$scope', '$http', function($scope, $http) {
                $scope.validationStatus = '';
                $scope.sendNewUser = function() {
                    if(validateData()) {
                        $http({
                            method:'post',
                            url:'register',
                            data : {
                                email : document.getElementById('email').value,
                                userName : document.getElementById('userName').value,
                                password : document.getElementById('password').value,
                            }
                        }).then(function successCallback(response){

                            localStorage.token = response.data.token;
                            localStorage.userName = response.data.userName;
                            window.location = '/userConfirmation?' + localStorage.userName
                        }, function errorCallback() {

                        });
                    }
                }
                var validateData = function() {
                    var email = document.getElementById('email').value;
                    var password = document.getElementById('password').value;
                    var confirmPassword = document.getElementById('confirmPassword').value;
                    var userName =  document.getElementById('userName').value;
                    if(email.indexOf('@') === -1 || email.substr(email.length - 4) != '.com') {
                        $scope.validationStatus = "incorrectEmail";
                        return false;
                    }
                    else if(password != confirmPassword) {
                        $scope.validationStatus = "passwordMatch";
                        return false;
                    }
                    else if(password ==='' || confirmPassword=== ''){
                        $scope.validationStatus = "noPassword";
                        return false;
                    }
                    else if(userName === '') {
                        $scope.validationStatus = "noUserName";
                        return false;
                    }
                    else {
                        $scope.validationStatus = "";
                        return true;
                    }
                }
            }]);


        </script>
        <script src="./directives/register.js"></script>


    </div>
</body>
</html>